 #include"graphics.h"
#include<math.h>
#include<conio.h>

#define Pi 3.1415926

#define N1 1000
#define N2 202
#define N3 N1

float x[N1],y[N3];

double h[N2] = {
  1.553187593776e-05,2.086152164832e-05,1.058670162252e-05,-1.185792207511e-05,
  -2.895702279077e-05,-2.54196538588e-05,-7.040782148088e-06,1.212445832301e-06,
  -1.71562861926e-05,-4.307371095248e-05,-3.06470066579e-05,4.487158709962e-05,
  0.0001437724798764,0.0001772872502395,8.502362142032e-05,-9.266990587486e-05,
  -0.0002285949622708,-0.0002160600860876,-7.578166634766e-05,5.267326589605e-05,
  4.803734901528e-05,-5.328888752368e-05,-7.191751367948e-05,0.0001274122443845,
  0.0004477006007444,0.0005844711899774, 0.000292818242348,-0.0003326717982348,
  -0.0008610236875679,-0.0008692196996952,-0.0003388704926967,0.0002902838973141,
  0.0005141623010318,0.0002595494872177,-2.340336156799e-05,0.0001747943448052,
  0.0008195013646341, 0.001226641545328,0.0006697539776661,-0.0008123101013761,
  -0.002228739162544,-0.002390369014994, -0.00100220742083,0.0009506860527543,
   0.002003637593019, 0.001540857631327, 0.000378461592166,-5.83799802162e-05,
  0.0007463579548647, 0.001705532740602,  0.00111160395137,-0.001499364453576,
  -0.004448102544439,-0.005101597421257, -0.00228495760482, 0.002334589935099,
   0.005417045340275, 0.004831384310626, 0.001603772303487,-0.001057906605453,
  -0.0009179944070296,0.0009713269413883, 0.001253263309001, -0.00212747179045,
  -0.007178163616718,-0.009016917726413,-0.004355447469024, 0.004780134076116,
    0.01197465568445,  0.01172263745346, 0.004440131793022,-0.003702280363223,
  -0.006395186417828,-0.003154364142493,0.0002784555359286,-0.002040137596764,
  -0.009402265553134,  -0.0138638106598,-0.007473724377804,  0.00897073406426,
    0.02441974207825,   0.0260549720367,  0.01089902105732, -0.01034766948098,
   -0.02190308706051, -0.01698231530923,-0.004223476996854,0.0006628818631263,
  -0.008670766243498, -0.02040361323823, -0.01379830905217,  0.01948723034502,
    0.06120550415677,  0.07535284721608,  0.03687880862563, -0.04216377886354,
    -0.1131951708888,   -0.122845406501, -0.05401451305321,  0.05616612741935,
      0.138242016919,    0.138242016919,  0.05616612741935, -0.05401451305321,
     -0.122845406501,  -0.1131951708888, -0.04216377886354,  0.03687880862563,
    0.07535284721608,  0.06120550415677,  0.01948723034502, -0.01379830905217,
   -0.02040361323823,-0.008670766243498,0.0006628818631263,-0.004223476996854,
   -0.01698231530923, -0.02190308706051, -0.01034766948098,  0.01089902105732,
     0.0260549720367,  0.02441974207825,  0.00897073406426,-0.007473724377804,
    -0.0138638106598,-0.009402265553134,-0.002040137596764,0.0002784555359286,
  -0.003154364142493,-0.006395186417828,-0.003702280363223, 0.004440131793022,
    0.01172263745346,  0.01197465568445, 0.004780134076116,-0.004355447469024,
  -0.009016917726413,-0.007178163616718, -0.00212747179045, 0.001253263309001,
  0.0009713269413883,-0.0009179944070296,-0.001057906605453, 0.001603772303487,
   0.004831384310626, 0.005417045340275, 0.002334589935099, -0.00228495760482,
  -0.005101597421257,-0.004448102544439,-0.001499364453576,  0.00111160395137,
   0.001705532740602,0.0007463579548647,-5.83799802162e-05, 0.000378461592166,
   0.001540857631327, 0.002003637593019,0.0009506860527543, -0.00100220742083,
  -0.002390369014994,-0.002228739162544,-0.0008123101013761,0.0006697539776661,
   0.001226641545328,0.0008195013646341,0.0001747943448052,-2.340336156799e-05,
  0.0002595494872177,0.0005141623010318,0.0002902838973141,-0.0003388704926967,
  -0.0008692196996952,-0.0008610236875679,-0.0003326717982348, 0.000292818242348,
  0.0005844711899774,0.0004477006007444,0.0001274122443845,-7.191751367948e-05,
  -5.328888752368e-05,4.803734901528e-05,5.267326589605e-05,-7.578166634766e-05,
  -0.0002160600860876,-0.0002285949622708,-9.266990587486e-05,8.502362142032e-05,
  0.0001772872502395,0.0001437724798764,4.487158709962e-05,-3.06470066579e-05,
  -4.307371095248e-05,-1.71562861926e-05,1.212445832301e-06,-7.040782148088e-06,
  -2.54196538588e-05,-2.895702279077e-05,-1.185792207511e-05,1.058670162252e-05,
  2.086152164832e-05,1.553187593776e-05
};

float  voice(float t)
{
      return ( 0.5*cos(2*Pi*500*t) );
}

float  noise(float t)
{
    return(  rand()/32767.0 );
}

float receiving(float t)
{
    return( voice(t) + noise(t) );
}

float  w(int n)
{
    return(  1  );
}

float Digital_System(float xn)
{
    int n;
    static float x_delay[N2]={0};

    float y;

    for(n=N2-1;n>=1;n--)
       x_delay[n] = x_delay[n-1];
    x_delay[0] = xn;

    y = 0;
    for(n=0;n<=N2-1;n++)
	  y += h[n] * x_delay[n] ;

   return(y);
}


float Analog_LPF(float t,float y[],int N,float T)
{
   int n;
   float ya_t=0,k1,k2,k3;
   for(n=0;n<=N-1;n++)
   {
	   k1 = sin(Pi/T*( t - n*T)) ;
	   k2 = Pi/T*(t - n*T) ;
	   if(k2==0)
	      	 k3 = 1.0 ;  /* 0/0 =1 */
	   else
		 k3 = k1/k2;
	   ya_t   = ya_t +  y[n]*k3 ;
  }
  return(ya_t);
}


main()
{
  int i,n,driver=VGA,mode=VGAHI;
  float t,fs,T;

  initgraph(&driver,&mode,"");bar(0,0,639,479);
  setbkcolor(WHITE);
  setcolor(BLUE);

  moveto(10+0,40+20*voice(0) );
  for(i=0,t=0;t<0.03;t=t+0.00005,i++)
    lineto(10+i,40+20*voice(t));
  getch();

  moveto(10,100+20*noise(0) );
  for(i=0,t=0;t<0.03;t=t+0.00005,i++)
  	  lineto(10+i,100+20*noise(t));
  getch();


 
  setcolor(RED);
  moveto(10,180+20*receiving(0));
  for(i=0,t=0;t<0.03;t=t+0.00005,i++)
     lineto(10+i,180+20*receiving(t) );
  getch();

  fs = 4000;
  T  = 1/fs;
  for(n=0;n<N1;n++)
  {
      x[n] = receiving(n*T);
	  line(10+n*(T/0.00005),280,10+n*(T/0.00005),280+20*x[n]);
  }
   getch();

   for(n=0;n<N3;n++)
  {
      y[n] = Digital_System(x[n]);
      line(10+(n-60)*(T/0.00005),360,10+(n-60)*(T/0.00005),360+20*y[n]);
  }
  getch();

  moveto(10,440);
  for(i=0,t=60*T;t<60*T+0.03;t=t+0.00005,i++)
       lineto(10+i,440+20*Analog_LPF(t,y,N3,T));
  getch();

  closegraph();
}